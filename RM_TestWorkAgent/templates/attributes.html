<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attributes - {{ run.name }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link href="/static/css/app.css" rel="stylesheet">
</head>
<body>
    <!-- Header Ribbon with Both Logos -->
    <div class="header-ribbon">
        <div class="logo-container">
            <img src="/static/images/Logo_.png" alt="Company Logo" class="company-logo">
            <img src="/static/images/Coverlogo.png" alt="R&M TestWork Agent" class="project-logo">
        </div>
    </div>

    <!-- Navigation -->
    <nav class="navbar navbar-dark">
        <div class="container-fluid" style="padding: 0 2rem;">
            <a class="navbar-brand" href="/" style="color: white;">
                <i class="bi bi-clipboard-data"></i> Attributes
            </a>
            <div>
                <a href="/runs/{{ run.id }}" class="btn btn-sm" style="background: rgba(255,255,255,0.2); border: none; color: white; text-decoration: none;">
                    <i class="bi bi-arrow-left"></i> Back to Run
                </a>
            </div>
        </div>
    </nav>

    <div class="container-fluid" style="padding: 2rem;">
        <!-- Page Title -->
        <div class="row mb-4">
            <div class="col-12">
                <h2 style="color: #413178; font-weight: 600; font-size: 1.5rem;">
                    <i class="bi bi-check-square"></i> Attribute Testing - {{ run.name }}
                </h2>
            </div>
        </div>

        <!-- Info Card -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card" style="background: #FFFFFF; border: 1px solid #E9E7F2; border-radius: 16px; box-shadow: 0 2px 8px rgba(65, 49, 120, 0.08); overflow: hidden; padding: 0;">
                    <div style="background: #413178; color: white; padding: 1rem 1.5rem;">
                        <h5 class="mb-0" style="font-weight: 600;"><i class="bi bi-info-circle"></i> Attribute Testing Overview</h5>
                    </div>
                    <div style="padding: 1.5rem;">
                        {% if samples %}
                            <p class="mb-0" style="color: #413178;">Test samples against the 7 audit attributes below.</p>
                        {% else %}
                            <div class="alert" style="background: #EEEAFB; color: #342961; border-left: 4px solid #8A7BC4; border-radius: 8px; margin-bottom: 1rem;">
                                <i class="bi bi-exclamation-triangle"></i> <strong>No samples found.</strong> Please generate samples first.
                            </div>
                            <a href="/runs/{{ run.id }}/sampling" class="btn" style="background: #413178; color: white; border: none; font-weight: 600; text-decoration: none;">
                                <i class="bi bi-collection"></i> Go to Sampling
                            </a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        {% if samples %}
        <!-- Samples Statistics Cards -->
        <div class="row g-4 mb-4">
            <div class="col-xl-3 col-lg-6 col-md-6">
                <div class="dashboard-card">
                    <div class="card-content">
                        <span class="card-label">TOTAL SAMPLES</span>
                        <div class="card-value">{{ samples.total }}</div>
                        <p class="card-description">
                            <i class="bi bi-check-circle"></i> All samples
                        </p>
                    </div>
                    <div class="card-icon-wrapper">
                        <i class="bi bi-collection"></i>
                    </div>
                </div>
            </div>

            <div class="col-xl-3 col-lg-6 col-md-6">
                <div class="dashboard-card">
                    <div class="card-content">
                        <span class="card-label">COMPLETE</span>
                        <div class="card-value">{{ samples.items|selectattr('attributes_status', 'equalto', 'complete')|list|length }}</div>
                        <p class="card-description">
                            <i class="bi bi-check-circle"></i> Attributes tested
                        </p>
                    </div>
                    <div class="card-icon-wrapper">
                        <i class="bi bi-check-square"></i>
                    </div>
                </div>
            </div>

            <div class="col-xl-3 col-lg-6 col-md-6">
                <div class="dashboard-card">
                    <div class="card-content">
                        <span class="card-label">IN PROGRESS</span>
                        <div class="card-value">{{ samples.items|selectattr('attributes_status', 'equalto', 'in_progress')|list|length }}</div>
                        <p class="card-description">
                            <i class="bi bi-clock"></i> Being tested
                        </p>
                    </div>
                    <div class="card-icon-wrapper">
                        <i class="bi bi-hourglass-half"></i>
                    </div>
                </div>
            </div>

            <div class="col-xl-3 col-lg-6 col-md-6">
                <div class="dashboard-card">
                    <div class="card-content">
                        <span class="card-label">PENDING</span>
                        <div class="card-value">{{ samples.items|selectattr('attributes_status', 'equalto', 'pending')|list|length }}</div>
                        <p class="card-description">
                            <i class="bi bi-exclamation-circle"></i> Not started
                        </p>
                    </div>
                    <div class="card-icon-wrapper">
                        <i class="bi bi-clipboard"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Samples Table -->
        <div class="row">
            <div class="col-12">
                <div class="card" style="background: #FFFFFF; border: 1px solid #E9E7F2; border-radius: 16px; box-shadow: 0 2px 8px rgba(65, 49, 120, 0.08); overflow: hidden; padding: 0;">
                    <div style="background: #413178; color: white; padding: 1rem 1.5rem;">
                        <h5 class="mb-0" style="font-weight: 600;"><i class="bi bi-list"></i> Samples</h5>
                    </div>
                    <div style="padding: 1.5rem;">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Sample ID</th>
                                        <th>Account</th>
                                        <th>Amount</th>
                                        <th>Type</th>
                                        <th>Support Status</th>
                                        <th>Attributes Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for sample in samples.items %}
                                    <tr>
                                        <td style="color: #413178; font-weight: 600;">{{ loop.index }}</td>
                                        <td>
                                            <strong style="color: #413178;">{{ sample.gl_item.account_code }}</strong><br>
                                            <small class="text-muted">{{ sample.gl_item.account_name }}</small>
                                        </td>
                                        <td style="color: #413178; font-weight: 600;">${{ "%.2f"|format(sample.gl_item.amount) }}</td>
                                        <td><span class="badge" style="background: #6C5BB5; color: white;">{{ sample.sample_type }}</span></td>
                                        <td>
                                            <span class="badge 
                                                {% if sample.support_status == 'complete' %}bg-success
                                                {% elif sample.support_status == 'partial' %}bg-warning
                                                {% else %}bg-secondary{% endif %}">
                                                {{ sample.support_status|upper }}
                                            </span>
                                        </td>
                                        <td>
                                            <span class="badge 
                                                {% if sample.attributes_status == 'complete' %}bg-success
                                                {% elif sample.attributes_status == 'in_progress' %}bg-warning
                                                {% else %}bg-secondary{% endif %}">
                                                {{ sample.attributes_status|upper }}
                                            </span>
                                        </td>
                                        <td>
                                            <a href="/runs/{{ run.id }}/samples/{{ sample.id }}/attributes" 
                                               class="btn btn-sm" style="background: #413178; color: white; border: none; font-weight: 500; text-decoration: none;">
                                                <i class="bi bi-pencil"></i> Test Attributes
                                            </a>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>

                        <!-- Pagination -->
                        {% if samples.pages > 1 %}
                        <nav aria-label="Page navigation" class="mt-3">
                            <ul class="pagination justify-content-center">
                                {% if samples.has_prev %}
                                <li class="page-item">
                                    <a class="page-link" href="?page={{ samples.prev_num }}" style="color: #413178; text-decoration: none;">Previous</a>
                                </li>
                                {% endif %}
                                
                                {% for page_num in samples.iter_pages() %}
                                <li class="page-item {% if page_num == samples.page %}active{% endif %}">
                                    <a class="page-link" href="?page={{ page_num }}" 
                                       style="{% if page_num == samples.page %}background: #413178; border-color: #413178; color: white;{% else %}color: #413178;{% endif %} text-decoration: none;">
                                        {{ page_num }}
                                    </a>
                                </li>
                                {% endfor %}
                                
                                {% if samples.has_next %}
                                <li class="page-item">
                                    <a class="page-link" href="?page={{ samples.next_num }}" style="color: #413178; text-decoration: none;">Next</a>
                                </li>
                                {% endif %}
                            </ul>
                        </nav>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>